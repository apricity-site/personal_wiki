(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{393:function(t,a,e){"use strict";e.r(a);var n=e(46),s=Object(n.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"vagrant-入门"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#vagrant-入门"}},[t._v("#")]),t._v(" Vagrant 入门")]),t._v(" "),e("h2",{attrs:{id:"安装软件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装软件"}},[t._v("#")]),t._v(" 安装软件")]),t._v(" "),e("h3",{attrs:{id:"安装-virtualbox"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装-virtualbox"}},[t._v("#")]),t._v(" 安装 VirtualBox")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://www.virtualbox.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("VirtualBox官网"),e("OutboundLink")],1),t._v("下载"),e("a",{attrs:{href:"https://www.virtualbox.org/wiki/VirtualBox",target:"_blank",rel:"noopener noreferrer"}},[t._v("VirtualBox"),e("OutboundLink")],1),t._v("  platform packages和"),e("a",{attrs:{href:"https://www.virtualbox.org/wiki/VirtualBox",target:"_blank",rel:"noopener noreferrer"}},[t._v("VirtualBox"),e("OutboundLink")],1),t._v(" Extension Pack")]),t._v(" "),e("p",[t._v("在安装完主程序后，直接双击扩展包文件即可安装扩展包。")]),t._v(" "),e("h3",{attrs:{id:"安装-vagrant"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装-vagrant"}},[t._v("#")]),t._v(" 安装 Vagrant")]),t._v(" "),e("p",[t._v("在 "),e("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//www.vagrantup.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vagant 网站"),e("OutboundLink")],1),t._v("下载最新的版本，根据自己的操作系统选择对应的版本下载即可。")]),t._v(" "),e("p",[t._v("安装完毕后，通过命令行执行 "),e("code",[t._v("vagrant version")]),t._v(" 检查是否安装成功：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("> vagrant version\n")])])]),e("h2",{attrs:{id:"配置虚机存放位置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置虚机存放位置"}},[t._v("#")]),t._v(" 配置虚机存放位置")]),t._v(" "),e("p",[t._v("创建虚拟机会占用较多的磁盘空间，在 Windows 系统下默认的虚机创建位置是在 C 盘，所以最好配置到其它地方。")]),t._v(" "),e("h3",{attrs:{id:"配置-virtualbox"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-virtualbox"}},[t._v("#")]),t._v(" 配置 VirtualBox")]),t._v(" "),e("p",[t._v("启动 VirtualBox 后，通过菜单 "),e("code",[t._v("管理")]),t._v(" -> "),e("code",[t._v("全局设定")]),t._v("，或者按下快捷键 "),e("code",[t._v("Ctrl + g")]),t._v("，在全局设定对话框中，修改 "),e("code",[t._v("默认虚拟电脑位置")]),t._v("，指定一个容量较大的磁盘。")]),t._v(" "),e("h3",{attrs:{id:"配置-vagrant"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-vagrant"}},[t._v("#")]),t._v(" 配置 Vagrant")]),t._v(" "),e("p",[t._v("通过 Vagrant 创建虚机需要先导入镜像文件，也就是 "),e("code",[t._v("box")]),t._v("，它们默认存储的位置在用户目录下的 "),e("code",[t._v(".vagrant.d")]),t._v(" 目录下，对于 Windows 系统来说，就是 "),e("code",[t._v("C:\\Users\\用户名\\.vagrant.d")]),t._v("。")]),t._v(" "),e("p",[t._v("如果后续可能会用到较多镜像，或者你的 C 盘空间比较紧缺，可以通过设置环境变量 "),e("code",[t._v("VAGRANT_HOME")]),t._v(" 来设置该目录。")]),t._v(" "),e("p",[t._v("在 Windows 系统中，可以这样操作：新建系统环境变量，环境变量名为 "),e("code",[t._v("VAGRANT_HOME")]),t._v("，变量值为 "),e("code",[t._v("E:\\VirtualBox\\.vagrant.d")])]),t._v(" "),e("blockquote",[e("p",[e("strong",[t._v("注意")]),t._v("， "),e("code",[t._v(".vagrant.d")]),t._v(" 目录名称不是必须的，但是建议保持一致，这样一眼看上去就能知道这个目录是做什么用处的了。")])]),t._v(" "),e("h2",{attrs:{id:"下载虚机镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#下载虚机镜像"}},[t._v("#")]),t._v(" 下载虚机镜像")]),t._v(" "),e("p",[t._v("使用 Vagrant 创建虚机时，需要指定一个镜像，也就是 "),e("code",[t._v("box")]),t._v("。开始这个 box 不存在，所以 Vagrant 会先从网上下载，然后缓存在本地目录中。")]),t._v(" "),e("p",[t._v("Vagrant 有一个"),e("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//app.vagrantup.com/boxes/search",target:"_blank",rel:"noopener noreferrer"}},[t._v("镜像网站"),e("OutboundLink")],1),t._v("，里面列出了都有哪些镜像可以用，并且提供了操作文档。")]),t._v(" "),e("p",[t._v("但是这里默认下载往往会比较慢，所以下面我会介绍如何在其它地方下载到基础镜像，然后按照自己的需要重置。如果网速较好，下载顺利的朋友可以选择性地跳过部分内容。")]),t._v(" "),e("p",[t._v("两个 Linux 操作系统镜像的下载地址：")]),t._v(" "),e("h3",{attrs:{id:"centos"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#centos"}},[t._v("#")]),t._v(" CentOS")]),t._v(" "),e("p",[t._v("CentOS 的镜像下载网站是： "),e("a",{attrs:{href:"https://link.zhihu.com/?target=http%3A//cloud.centos.org/centos/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://cloud.centos.org/centos/"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("在其中选择自己想要下载的版本，列表中有一个 "),e("code",[t._v("vagrant")]),t._v(" 目录，里面是专门为 vagrant 构建的镜像。选择其中的 "),e("code",[t._v(".box")]),t._v(" 后缀的文件下载即可。这里可以使用下载工具，以较快的速度下载下来。")]),t._v(" "),e("h3",{attrs:{id:"ubuntu"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu"}},[t._v("#")]),t._v(" Ubuntu")]),t._v(" "),e("p",[t._v("Ubuntu 的镜像下载网站是： "),e("a",{attrs:{href:"https://link.zhihu.com/?target=http%3A//cloud-images.ubuntu.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://cloud-images.ubuntu.com/"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("同样先选择想要的版本，然后选择针对 vagrant 的 "),e("code",[t._v(".box")]),t._v(" 文件即可。")]),t._v(" "),e("p",[t._v("如果这里官网的速度较慢，还可以从 "),e("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//mirror.tuna.tsinghua.edu.cn/ubuntu-cloud-images/",target:"_blank",rel:"noopener noreferrer"}},[t._v("清华大学的镜像站"),e("OutboundLink")],1),t._v(" 下载。")]),t._v(" "),e("h2",{attrs:{id:"添加-box"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#添加-box"}},[t._v("#")]),t._v(" 添加 box")]),t._v(" "),e("p",[t._v("接下来我们需要将下载后的 "),e("code",[t._v(".box")]),t._v(" 文件添加到 vagrant 中。")]),t._v(" "),e("p",[t._v("Vagrant 没有 GUI，只能从命令行访问，先启动一个命令行，然后执行:")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ vagrant box list\nThere are no installed boxes! Use `vagrant box add` to add some.\n")])])]),e("p",[t._v("提示现在还没有 box。如果这是第一次运行，此时 "),e("code",[t._v("VAGRANT_HOME")]),t._v(" 目录下会自动生成若干的文件和文件夹，其中有一个 "),e("code",[t._v("boxes")]),t._v(" 文件夹，这就是要存放 box 文件的地方。")]),t._v(" "),e("p",[t._v("执行 "),e("code",[t._v("vagrant box add")]),t._v(" 命令添加 box:")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ vagrant box add e:\\Downloads\\CentOS-7.box --name centos-7\n==> box: Box file was not detected as metadata. Adding it directly...\n==> box: Adding box 'centos-7' (v0) for provider:\n    box: Unpacking necessary files from: file:///e:/Downloads/CentOS-7.box\n    box:\n==> box: Successfully added box 'centos-7' (v0) for 'virtualbox'!\n")])])]),e("p",[t._v("命令后面跟着的是下载的文件路径，并且通过 "),e("code",[t._v("--name centos-7")]),t._v(" 为这个 box 指定一个名字。")]),t._v(" "),e("p",[t._v("再次查询，可以看到有了一个 box：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ vagrant box list\ncentos-7 (virtualbox, 0)\n")])])]),e("h2",{attrs:{id:"vagrant-基本操作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#vagrant-基本操作"}},[t._v("#")]),t._v(" Vagrant 基本操作")]),t._v(" "),e("h3",{attrs:{id:"新建虚机"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新建虚机"}},[t._v("#")]),t._v(" 新建虚机")]),t._v(" "),e("p",[t._v("创建一个目录，先执行 "),e("code",[t._v("vagrant init")]),t._v("：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ mkdir demo\n$ cd demo\n$ vagrant init centos-7\nA `Vagrantfile` has been placed in this directory. You are now\nready to `vagrant up` your first virtual environment! Please read\nthe comments in the Vagrantfile as well as documentation on\n`vagrantup.com` for more information on using Vagrant.\n")])])]),e("p",[t._v("其中的 "),e("code",[t._v("centos-7")]),t._v(" 就是我们要使用的 "),e("code",[t._v("box")]),t._v(" 名字。")]),t._v(" "),e("p",[t._v("这个命令只是为我们生成一个 "),e("code",[t._v("Vagrantfile")]),t._v("，所以，这里的名字没指定或者写错了都没关系，后面会介绍如何编辑这个 "),e("code",[t._v("Vagrantfile")]),t._v(" 来修改。")]),t._v(" "),e("h3",{attrs:{id:"启动虚机"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动虚机"}},[t._v("#")]),t._v(" 启动虚机")]),t._v(" "),e("p",[t._v("我们等会再来细看这个文件，现在直接按照提示执行 "),e("code",[t._v("vagrant up")]),t._v("：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ vagrant up\nBringing machine 'default' up with 'virtualbox' provider...\n==> default: Importing base box 'centos-7'...\n==> default: Matching MAC address for NAT networking...\n==> default: Setting the name of the VM: demo_default_1588406874156_65036\n==> default: Clearing any previously set network interfaces...\n==> default: Preparing network interfaces based on configuration...\n    default: Adapter 1: nat\n==> default: Forwarding ports...\n    default: 22 (guest) => 2222 (host) (adapter 1)\n==> default: Booting VM...\n==> default: Waiting for machine to boot. This may take a few minutes...\n    default: SSH address: 127.0.0.1:2222\n    default: SSH username: vagrant\n    default: SSH auth method: private key\n")])])]),e("p",[t._v("正常的情况下，不到一分钟应该就能启动成功了。")]),t._v(" "),e("p",[t._v("注意到这里包含的信息：")]),t._v(" "),e("ul",[e("li",[t._v("虚机名称："),e("code",[t._v("demo_default_1588406874156_65036")]),t._v("（想改？最后有提）")]),t._v(" "),e("li",[t._v("网卡："),e("code",[t._v("Adapter 1: nat")]),t._v("，第一块网卡，NAT 模式，这是固定的")]),t._v(" "),e("li",[t._v("端口转发："),e("code",[t._v("22 (guest) => 2222 (host) (adapter 1)")]),t._v("，把虚机的 22 端口，映射到宿主机的 2222 端口上，这样就可以通过 "),e("code",[t._v("127.0.0.1:2222")]),t._v(" 访问虚拟机了")]),t._v(" "),e("li",[t._v("SSH 用户名："),e("code",[t._v("vagrant")]),t._v("，这里使用 "),e("code",[t._v("private key")]),t._v(" 登录")])]),t._v(" "),e("blockquote",[e("p",[t._v("密码也是 "),e("code",[t._v("vagrant")]),t._v("，但是密码方式仅供直接登录，是不能通过 SSH 登录的。")])]),t._v(" "),e("h3",{attrs:{id:"查看虚机状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看虚机状态"}},[t._v("#")]),t._v(" 查看虚机状态")]),t._v(" "),e("p",[t._v("执行下面的命令可以查看虚机的状态：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("vagrant status\n\nCurrent machine states:\n\ndefault                   running (virtualbox)\n\nThe VM is running. To stop this VM, you can run `vagrant halt` to\nshut it down forcefully, or you can run `vagrant suspend` to simply\nsuspend the virtual machine. In either case, to restart it again,\nsimply run `vagrant up`.\n")])])]),e("p",[t._v("该命令还提示了如何操作虚机")]),t._v(" "),e("h3",{attrs:{id:"连接虚机"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#连接虚机"}},[t._v("#")]),t._v(" 连接虚机")]),t._v(" "),e("p",[t._v("如果启动没问题，接下来执行 "),e("code",[t._v("vagrant ssh")]),t._v(" 就能以 "),e("code",[t._v("vagrant")]),t._v(" 用户直接登入虚机中。")]),t._v(" "),e("p",[e("code",[t._v("root")]),t._v(" 用户没有默认密码，也不能直接登录。需要 root 权限的命令可以通过在命令前添加 "),e("code",[t._v("sudo")]),t._v(" 来执行，也可以执行 "),e("code",[t._v("sudo -i")]),t._v(" 直接切换到 "),e("code",[t._v("root")]),t._v(" 用户。")]),t._v(" "),e("p",[t._v("这时候打开 VirtualBox 程序，可以看到自动创建的虚机")]),t._v(" "),e("p",[t._v("我们也可以在 VirtualBox 的终端上登录系统，默认的登录用户名和密码都是 "),e("code",[t._v("vagrant")]),t._v("。")]),t._v(" "),e("p",[t._v("当然还可以使用其它的 SSH 连接工具例如 XShell，SecureCRT 连接，但是这里默认网卡使用的是 NAT 模式，没有指定 IP，实际应用并不方便，我们在后面介绍网络配置固定ip。")]),t._v(" "),e("h3",{attrs:{id:"停止虚机"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#停止虚机"}},[t._v("#")]),t._v(" 停止虚机")]),t._v(" "),e("p",[t._v("执行下面的命令可以关闭虚机：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("vagrant halt\n")])])]),e("p",[t._v("直接在 VirtualBox 上关闭虚机，或者直接在虚机内部执行 "),e("code",[t._v("poweroff")]),t._v(" 命令也都是可以的。")]),t._v(" "),e("h3",{attrs:{id:"暂停虚机"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#暂停虚机"}},[t._v("#")]),t._v(" 暂停虚机")]),t._v(" "),e("p",[t._v("执行下面的命令可以暂停虚机：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("vagrant suspend\n")])])]),e("h3",{attrs:{id:"恢复虚机"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#恢复虚机"}},[t._v("#")]),t._v(" 恢复虚机")]),t._v(" "),e("p",[t._v("执行下面的命令把暂停状态的虚机恢复运行：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("vagrant resume\n")])])]),e("p",[e("strong",[t._v("注意：")]),t._v(" 不管虚机是关闭还是暂停状态，甚至是 error 状态，都可以执行 "),e("code",[t._v("vagrant up")]),t._v(" 来让虚机恢复运行。")]),t._v(" "),e("h3",{attrs:{id:"重载虚机"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重载虚机"}},[t._v("#")]),t._v(" 重载虚机")]),t._v(" "),e("p",[t._v("执行下面的命令会重启虚机，并且重新加载 "),e("code",[t._v("Vagrantfile")]),t._v(" 中的配置信息：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("vagrant reload\n")])])]),e("h3",{attrs:{id:"删除虚机"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#删除虚机"}},[t._v("#")]),t._v(" 删除虚机")]),t._v(" "),e("p",[t._v("最后，执行下面的命令可以彻底删除虚机，包括整个虚机文件：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("vagrant destroy\n")])])]),e("p",[e("strong",[t._v("注意：")]),t._v(" 在当前这个小例子中，上面所有的 "),e("code",[t._v("vagrant")]),t._v(" 命令都需要在 "),e("code",[t._v("Vagrantfile")]),t._v(" 所在的目录下执行。")]),t._v(" "),e("h2",{attrs:{id:"初识-vagrantfile"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#初识-vagrantfile"}},[t._v("#")]),t._v(" 初识 Vagrantfile")]),t._v(" "),e("p",[t._v("先来认识一下默认的 "),e("code",[t._v("Vagrantfile")]),t._v(" 文件，使用带语法高亮的文本编辑器（例如 VSCode） 打开:")]),t._v(" "),e("div",{staticClass:"language-ruby extra-class"},[e("pre",{pre:!0,attrs:{class:"language-ruby"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -*- mode: ruby -*-")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi: set ft=ruby :")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# All Vagrant configuration is done below. The "2" in Vagrant.configure')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# configures the configuration version (we support older styles for")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# backwards compatibility). Please don't change it unless you know what")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# you're doing.")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Vagrant")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("configure"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("config"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The most common configuration options are documented and commented below.")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# For a complete reference, please see the online documentation at")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# https://docs.vagrantup.com.")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Every Vagrant development environment requires a box. You can search for")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# boxes at https://vagrantcloud.com/search.")]),t._v("\n  config"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("vm"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("box "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"centos-7"')]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Disable automatic box update checking. If you disable this, then")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# boxes will only be checked for updates when the user runs")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# `vagrant box outdated`. This is not recommended.")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# config.vm.box_check_update = false")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create a forwarded port mapping which allows access to a specific port")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# within the machine from a port on the host machine. In the example below,")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# accessing "localhost:8080" will access port 80 on the guest machine.')]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# NOTE: This will enable public access to the opened port")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# config.vm.network "forwarded_port", guest: 80, host: 8080')]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create a forwarded port mapping which allows access to a specific port")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# within the machine from a port on the host machine and only allow access")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# via 127.0.0.1 to disable public access")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# config.vm.network "forwarded_port", guest: 80, host: 8080, host_ip: "127.0.0.1"')]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create a private network, which allows host-only access to the machine")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# using a specific IP.")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# config.vm.network "private_network", ip: "192.168.33.10"')]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create a public network, which generally matched to bridged network.")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Bridged networks make the machine appear as another physical device on")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# your network.")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# config.vm.network "public_network"')]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Share an additional folder to the guest VM. The first argument is")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the path on the host to the actual folder. The second argument is")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the path on the guest to mount the folder. And the optional third")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# argument is a set of non-required options.")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# config.vm.synced_folder "../data", "/vagrant_data"')]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Provider-specific configuration so you can fine-tune various")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# backing providers for Vagrant. These expose provider-specific options.")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Example for VirtualBox:")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# config.vm.provider "virtualbox" do |vb|')]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   # Display the VirtualBox GUI when booting the machine")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   vb.gui = true")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   # Customize the amount of memory on the VM:")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#   vb.memory = "1024"')]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# end")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# View the documentation for the provider you are using for more")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# information on available options.")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Enable provisioning with a shell script. Additional provisioners such as")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Ansible, Chef, Docker, Puppet and Salt are also available. Please see the")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# documentation for more information about their specific syntax and use.")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# config.vm.provision "shell", inline: <<-SHELL')]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   apt-get update")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   apt-get install -y apache2")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# SHELL")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),e("p",[t._v("这是一个 Ruby 语法的文件，因为 Vagrant 就是用 Ruby 编写的。如果编辑器没有语法高亮可以手动设置文件类型为 Ruby。")]),t._v(" "),e("p",[t._v("这个缺省文件内容几乎都是注释，提示有哪些配置项可以修改，我们不需要去学 Ruby 编程也可以照葫芦画瓢的完成基本的配置。")]),t._v(" "),e("blockquote",[e("p",[t._v("当然，如果会 Ruby 编程的可以在此实现更高级的作用，但是绝大多数人用不着。")])]),t._v(" "),e("p",[t._v("刨除注释，这个文件的实际生效内容实际只有 3 行:")]),t._v(" "),e("div",{staticClass:"language-ruby extra-class"},[e("pre",{pre:!0,attrs:{class:"language-ruby"}},[e("code",[e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Vagrant")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("configure"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("config"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n  config"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("vm"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("box "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"centos-7"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),e("p",[t._v("首尾两行组成一个代码块结构，不要去动它，除非你知道自己在干什么。我们平常只需要编辑这其中的配置项。")]),t._v(" "),e("p",[t._v("这里的 "),e("code",[t._v("config.vm.box")]),t._v(" 对应的就是虚机的镜像，也就是 box 文件，这是唯一必填的配置项。")]),t._v(" "),e("p",[t._v("特别提醒，"),e("code",[t._v("Vagrantfile")]),t._v(" 文件名是固定的写法，大小写也要完全一样，修改了就不认识了。")]),t._v(" "),e("h2",{attrs:{id:"自定义配置-vagrantfile"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#自定义配置-vagrantfile"}},[t._v("#")]),t._v(" 自定义配置 Vagrantfile")]),t._v(" "),e("p",[t._v("下面我将针对这份默认的 "),e("code",[t._v("Vagrantfile")]),t._v(" 内容，逐个讲解其中的配置含义和如何根据实际情况修改。")]),t._v(" "),e("h3",{attrs:{id:"配置端口转发"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置端口转发"}},[t._v("#")]),t._v(" 配置端口转发")]),t._v(" "),e("p",[t._v("端口转发（Port forward）又叫端口映射，就是把虚机的某个端口，映射到宿主机的端口上。这样就能在宿主机上访问到虚拟机中的服务。")]),t._v(" "),e("p",[t._v("例如启动虚机时，默认的 "),e("code",[t._v("22 (guest) => 2222 (host) (adapter 1)")]),t._v(" 就是把虚机的 SSH 服务端口（"),e("code",[t._v("22")]),t._v("）映射到宿主机的 "),e("code",[t._v("2222")]),t._v(" 端口，这样直接在宿主机通过 ssh 客户端访问 "),e("code",[t._v("127.0.0.1:2222")]),t._v(" 端口就等价于访问虚拟机的 "),e("code",[t._v("22")]),t._v(" 端口。")]),t._v(" "),e("div",{staticClass:"language-ruby extra-class"},[e("pre",{pre:!0,attrs:{class:"language-ruby"}},[e("code",[t._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create a forwarded port mapping which allows access to a specific port")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# within the machine from a port on the host machine. In the example below,")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# accessing "localhost:8080" will access port 80 on the guest machine.')]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# NOTE: This will enable public access to the opened port")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# config.vm.network "forwarded_port", guest: 80, host: 8080')]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create a forwarded port mapping which allows access to a specific port")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# within the machine from a port on the host machine and only allow access")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# via 127.0.0.1 to disable public access")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# config.vm.network "forwarded_port", guest: 80, host: 8080, host_ip: "127.0.0.1"')]),t._v("\n")])])]),e("p",[t._v("实际上设置端口转发这个功能并不实用，一个很明显的问题就是如果启动多个虚机，很容易就出现宿主机上端口冲突的问题。即使没有端口冲突，使用起来也不方便，我个人不推荐使用的，可以把这部分配置直接删掉。直接使用下面的私有网络。")]),t._v(" "),e("p",[t._v("这个功能是虚拟机软件提供的，可以在虚机的网卡设置中展开高级选项，找到端口转发相关配置")]),t._v(" "),e("p",[t._v("注意，默认的 SSH 端口映射在这里没法直接修改。如果2222 端口出现莫名问题，如果想要把 22 端口转发到其它端口如 22222，直接添加下面这样的配置是"),e("strong",[t._v("没用")]),t._v("的：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('  config.vm.network "forwarded_port", guest: 22, host: 22222\n')])])]),e("p",[t._v("它会在原来的基础上新加一个端口转发规则，而不是替代原来的，必须要先强制关闭掉默认的那条规则:")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('  config.vm.network "forwarded_port", guest: 22, host: 2222, id: "ssh", disabled: "true"\n  config.vm.network "forwarded_port", guest: 22, host: 22222\n')])])]),e("h3",{attrs:{id:"配置私有网络"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置私有网络"}},[t._v("#")]),t._v(" 配置私有网络")]),t._v(" "),e("p",[t._v("下面这段配置用来配置私有网络，实际上对应的是 VirtualBox 的主机网络，也就是 HostOnly 网络。")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('  # Create a private network, which allows host-only access to the machine\n  # using a specific IP.\n  # config.vm.network "private_network", ip: "192.168.33.10"\n')])])]),e("p",[t._v("取消注释最下面一行，就可以为虚机设置指定的私有网络地址：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('  config.vm.network "private_network", ip: "192.168.33.10"\n')])])]),e("p",[t._v("如果这个网段的主机网络在 VirtualBox 中不存在，Vagrant 会在启动虚机时自动创建。所以，如果你想要利用已有的网络，请查看现有"),e("strong",[t._v("主机网络")]),t._v("配置：")]),t._v(" "),e("p",[t._v("最好这个网络也"),e("strong",[t._v("不要启用 DHCP")]),t._v("，完全由自己来分配地址，这样更加清楚。")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('  config.vm.network "private_network", ip: "192.168.56.10"\n')])])]),e("p",[t._v("修改完成后，执行 "),e("code",[t._v("vagrant reload")]),t._v(" 命令重建虚机，就能看到多出来的网卡了。")]),t._v(" "),e("p",[t._v("私有网络实际也可以直接使用 DHCP，但是并不推荐：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('  config.vm.network "private_network", type: "dhcp"\n')])])]),e("p",[e("strong",[t._v("如果"),e("code",[t._v("reload")]),t._v("后报错网卡找不到，需要先禁用网卡再启用")])]),t._v(" "),e("h3",{attrs:{id:"配置公共网络"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置公共网络"}},[t._v("#")]),t._v(" 配置公共网络")]),t._v(" "),e("p",[t._v("下面这条配置用来配置公共网络：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('  # Create a public network, which generally matched to bridged network.\n  # Bridged networks make the machine appear as another physical device on\n  # your network.\n  # config.vm.network "public_network"\n')])])]),e("p",[t._v("正如注释所说，这里通常对应的就是桥接网络。实际开发场景下，我们极少会需要把虚机暴露到公共网络上，这样既不安全，也没有必要。")]),t._v(" "),e("p",[t._v("默认所起的第 1 个 NAT 网络已经保证了虚机可以上互联网，而私有网络保证了宿主机和虚机，以及虚机和虚机之间的通信。如果有对外暴露服务的需求，还可以使用端口转发。我实在想不出什么情况下是必须要用桥接网络的。")]),t._v(" "),e("p",[t._v("所以这部分配置可以直接删除，如确有使用的，可以参考 "),e("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//www.vagrantup.com/docs/networking/public_network.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),e("OutboundLink")],1),t._v("。")]),t._v(" "),e("h3",{attrs:{id:"配置同步文件夹"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置同步文件夹"}},[t._v("#")]),t._v(" 配置同步文件夹")]),t._v(" "),e("p",[t._v("下面的配置项用来配置同步文件夹:")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('  # Share an additional folder to the guest VM. The first argument is\n  # the path on the host to the actual folder. The second argument is\n  # the path on the guest to mount the folder. And the optional third\n  # argument is a set of non-required options.\n  # config.vm.synced_folder "../data", "/vagrant_data"\n')])])]),e("p",[t._v("在启动虚机的时候，我们可以看到这样的提示：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("==> default: Machine booted and ready!\n==> default: Checking for guest additions in VM...\n    default: No guest additions were detected on the base box for this VM! Guest\n    default: additions are required for forwarded ports, shared folders, host only\n    default: networking, and more. If SSH fails on this machine, please install\n    default: the guest additions and repackage the box to continue.\n    default:\n    default: This is not an error message; everything may continue to work properly,\n    default: in which case you may ignore this message.\n==> default: Configuring and enabling network interfaces...\n==> default: Rsyncing folder: /cygdrive/c/Users/Davy/demo/ => /vagrant\n")])])]),e("p",[t._v("先注意最后一行的提示："),e("code",[t._v("Rsyncing folder: /cygdrive/c/Users/Davy/demo/ => /vagrant")])]),t._v(" "),e("ul",[e("li",[e("code",[t._v("/cygdrive/c/Users/Davy/demo/")]),t._v(" 这是宿主机的本地目录，也就是 "),e("code",[t._v("Vagrantfile")]),t._v(" 所在的目录。")]),t._v(" "),e("li",[e("code",[t._v("/vagrant")]),t._v(" 是虚拟机内部的路径")]),t._v(" "),e("li",[e("code",[t._v("Rsyncing")]),t._v(" 表示同步的方式是 Rsync")])]),t._v(" "),e("blockquote",[e("p",[t._v("宿主机目录中出现 "),e("code",[t._v("/cygdrive")]),t._v(" 是因为 Vagrant 程序用到了 Cygwin，它是在 Windows 系统中兼容 Linux/POSIX 的模拟层。可以把 "),e("code",[t._v("/cygdrive")]),t._v(" 看成是虚拟的根目录。")])]),t._v(" "),e("p",[t._v("同步文件操作步骤：")]),t._v(" "),e("ul",[e("li",[t._v("在 "),e("code",[t._v("demo")]),t._v(" 目录下创建一些文件，例如 "),e("code",[t._v("hello.py")])]),t._v(" "),e("li",[t._v("执行 "),e("code",[t._v("vagrant reload")]),t._v("，重启虚机")]),t._v(" "),e("li",[t._v("在虚机启动完成后登录到虚机内，操作如下：")])]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ vagrant ssh\nLast login: Sat May  2 16:25:00 2020 from 10.0.2.2\n[vagrant@localhost ~]$ cd /vagrant/\n[vagrant@localhost vagrant]$ ls\nhello.py  Vagrantfile\n[vagrant@localhost vagrant]$ python hello.py\nhelloworld\n")])])]),e("p",[t._v("这种同步方式在大多数情况下都能提供便利，不过也有不足之处：")]),t._v(" "),e("ul",[e("li",[t._v("同步是一次性的，即只有启动虚机的时候执行，也就是说改了代码必须要重启一次虚机")]),t._v(" "),e("li",[t._v("单向的，即只能从宿主机同步到虚拟机，也就是说在虚机内的改动不会同步到外面")]),t._v(" "),e("li",[t._v("需要拷贝文件，如果要同步的文件数量较多，会占用更多的磁盘空间")])]),t._v(" "),e("p",[t._v("让我们按照默认配置的提示来新加一条同步文件夹配置试试：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('config.vm.synced_folder "../data", "/vagrant_data"\n')])])]),e("p",[t._v("注意，别忘了先在宿主机上创建 "),e("code",[t._v("data")]),t._v(" 文件夹，重启虚机可能看到下面的错误提示：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("==> default: Rsyncing folder: /cygdrive/c/Users/Davy/demo/ => /vagrant\n==> default: Mounting shared folders...\n    default: /vagrant_data => C:/Users/Davy/data\nVagrant was unable to mount VirtualBox shared folders. This is usually\nbecause the filesystem \"vboxsf\" is not available. This filesystem is\nmade available via the VirtualBox Guest Additions and kernel module.\nPlease verify that these guest additions are properly installed in the\nguest. This is not a bug in Vagrant and is usually caused by a faulty\nVagrant box. For context, the command attempted was:\n\nmount -t vboxsf -o uid=1000,gid=1000 vagrant_data /vagrant_data\n\nThe error output from the command was:\n\nmount: unknown filesystem type 'vboxsf'\n")])])]),e("p",[t._v("这是因为 Vagrant 提供了多种同步方式，在使用 VirtualBox 的时候，缺省同步类型是 "),e("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//www.vagrantup.com/docs/synced-folders/virtualbox.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("vboxsf 挂载文件系统"),e("OutboundLink")],1),t._v("，它需要在虚拟机内部安装客户机增强包，也就是 "),e("code",[t._v("VirtualBox Guest Additions")]),t._v("（输出信息中也提示了）。")]),t._v(" "),e("p",[t._v("如何在虚机系统中安装 "),e("code",[t._v("guest additions")]),t._v(" 要分操作系统而定，有点小坑，后面会细说，现在修改一下配置，明确指定同步类型是 "),e("code",[t._v("rsync")]),t._v("：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('config.vm.synced_folder "../data", "/vagrant_data", type: "rsync"\n')])])]),e("p",[t._v("这样表示仍然使用 "),e("code",[t._v("rsync")]),t._v(" 来单向同步。")]),t._v(" "),e("h3",{attrs:{id:"更改虚机规格"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#更改虚机规格"}},[t._v("#")]),t._v(" 更改虚机规格")]),t._v(" "),e("p",[t._v("VirtualBox 等虚拟机软件在 Vagrant 中被称为 Provider，虚机的规格等配置是和 Provider 相关的。因为 VirtualBox 用的最多，所以默认的配置提示是以 VirtualBox 举例。")]),t._v(" "),e("p",[t._v("如果想要了解其它 Provider 的配置，请参考 "),e("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//www.vagrantup.com/docs/providers/",target:"_blank",rel:"noopener noreferrer"}},[t._v("文档"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("把中间那一段取消注释，其它的可以删掉：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('  # Provider-specific configuration so you can fine-tune various\n  # backing providers for Vagrant. These expose provider-specific options.\n  # Example for VirtualBox:\n  #\n  # config.vm.provider "virtualbox" do |vb|\n  #   # Display the VirtualBox GUI when booting the machine\n  #   vb.gui = true\n  #\n  #   # Customize the amount of memory on the VM:\n  #   vb.memory = "1024"\n  # end\n  #\n  # View the documentation for the provider you are using for more\n  # information on available options.\n')])])]),e("p",[t._v("使用 VSCode 时，选中它们，然后按下快捷键 "),e("code",[t._v("Ctrl + /")]),t._v(" 即可：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('  config.vm.provider "virtualbox" do |vb|\n    # Display the VirtualBox GUI when booting the machine\n    vb.gui = true\n\n    # Customize the amount of memory on the VM:\n    vb.memory = "1024"\n  end\n')])])]),e("p",[e("code",[t._v("vb.gui = true")]),t._v(" 是在虚机启动时自动打开 VirtualBox 的图形界面，这对服务器来说没什么用，直接删掉。")]),t._v(" "),e("p",[t._v("添加 CPU 的配置，同时修改内存大小：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('  config.vm.provider "virtualbox" do |vb|\n    vb.cpus = 2\n    vb.memory = 2048\n  end\n')])])]),e("p",[t._v("注意到，内存的大小单位是 MB，值是数字，默认的示例中有引号，实际也可以不加。")]),t._v(" "),e("p",[t._v("特别提醒一下，在 "),e("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//www.vagrantup.com/docs/virtualbox/configuration.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("说明文档"),e("OutboundLink")],1),t._v(" 里给的例子，其中的变量名是 "),e("code",[t._v("v")]),t._v("，这其实是在双竖线中定义的，直接拷贝的时候要看清楚。")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('config.vm.provider "virtualbox" do |v|\n  v.memory = 1024\n  v.cpus = 2\nend\n')])])]),e("h3",{attrs:{id:"provision"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#provision"}},[t._v("#")]),t._v(" Provision")]),t._v(" "),e("p",[t._v("Provision 是指在虚机初次创建的时候，Vagrant 自动去执行的构造任务，比如安装软件，更新系统配置等。")]),t._v(" "),e("p",[t._v("因为 box 往往只提供基础的系统（虽然我们可以自定义 box，但是并不是每次都要这么做，而且这样做会丧失一部分灵活性），有些东西仍然需要在创建虚机的时候完成。")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('  # Enable provisioning with a shell script. Additional provisioners such as\n  # Ansible, Chef, Docker, Puppet and Salt are also available. Please see the\n  # documentation for more information about their specific syntax and use.\n  # config.vm.provision "shell", inline: &lt;&lt;-SHELL\n  #   apt-get update\n  #   apt-get install -y apache2\n  # SHELL\n')])])]),e("p",[t._v("因为这部分完全是个开放的内容，所以我们这里不过多讨论，来看一下什么情况下会触发 provision 的操作：")]),t._v(" "),e("ul",[e("li",[t._v("某个环境初次执行 "),e("code",[t._v("vagrant up")]),t._v(" 的时候")]),t._v(" "),e("li",[t._v("执行 "),e("code",[t._v("vagrant provision")]),t._v(" 命令")]),t._v(" "),e("li",[t._v("重启的时候 "),e("code",[t._v("vagrant reload --provision")]),t._v("，带上 "),e("code",[t._v("--provision")]),t._v(" 选项")])]),t._v(" "),e("p",[t._v("除了上面这些默认提示给出的配置项，Vagrantfile 还支持其它很多配置，具体请 "),e("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//www.vagrantup.com/docs/vagrantfile/",target:"_blank",rel:"noopener noreferrer"}},[t._v("查看文档"),e("OutboundLink")],1),t._v("。")]),t._v(" "),e("p",[t._v("由于 Vagrantfile 本身是 Ruby 脚本，所以它并不仅仅是静态的配置文件，而且可以包含程序逻辑，例如在 "),e("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//www.vagrantup.com/docs/multi-machine/",target:"_blank",rel:"noopener noreferrer"}},[t._v("如何创建多个虚机"),e("OutboundLink")],1),t._v(" 中就有应用，有兴趣的可以自行研究。")]),t._v(" "),e("h2",{attrs:{id:"定制带客户机增强的-box"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#定制带客户机增强的-box"}},[t._v("#")]),t._v(" 定制带客户机增强的 box")]),t._v(" "),e("h3",{attrs:{id:"下载-guest-addition"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#下载-guest-addition"}},[t._v("#")]),t._v(" 下载 Guest Addition")]),t._v(" "),e("p",[t._v("VirtualBox 的"),e("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//www.virtualbox.org/wiki/Downloads",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载页面"),e("OutboundLink")],1),t._v("并没有直接给出 Guest Addtion 的下载链接，我们先在 VirtualBox 的任一下载链接上右键，复制链接地址，例如得到 "),e("code",[t._v("https://download.virtualbox.org/virtualbox/6.1.6/VirtualBox-6.1.6-137129-Win.exe")]),t._v("，去掉最后的文件名，把其中的路径 "),e("code",[t._v("https://download.virtualbox.org/virtualbox/6.1.6/")]),t._v(" 在浏览器中打开，就能看到所有可下载的版本，在其中找到 "),e("code",[t._v("VBoxGuestAdditions_6.1.6.iso")]),t._v(" 直接下载。")]),t._v(" "),e("h3",{attrs:{id:"安装-guest-addition"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装-guest-addition"}},[t._v("#")]),t._v(" 安装 Guest Addition")]),t._v(" "),e("p",[t._v("重新使用 Vagrant 从原始的镜像启动一个干净的虚机。")]),t._v(" "),e("p",[e("code",[t._v("VBoxGuestAdditions_6.1.6.iso")]),t._v(" 需要以光盘的形式挂载到虚机上，但是默认启动的这个虚机是没有光驱的。添加虚拟光驱需要先将虚机关闭。")]),t._v(" "),e("p",[t._v("然后在 VirtualBox 界面上操作，打开 "),e("code",[t._v("设置")]),t._v("，选择 "),e("code",[t._v("存储")]),t._v("，点击 "),e("code",[t._v("添加虚拟光驱")]),t._v("，点击 "),e("code",[t._v("控制器： IDE")]),t._v("，选择 "),e("code",[t._v("VBoxGuestAdditions_6.1.6.iso")]),t._v("，点击 "),e("code",[t._v("OK")])]),t._v(" "),e("p",[t._v("直接在 VirtualBox 上启动虚机，如果你在虚机菜单上选择 "),e("code",[t._v("设备")]),t._v(" - "),e("code",[t._v("安装增强功能")]),t._v("，大概率是会遇到错误，别管它，我们手动来安装。")]),t._v(" "),e("p",[t._v("使用 "),e("code",[t._v("vagrant/vagrant")]),t._v(" 登录到虚机内，切换到 "),e("code",[t._v("root")]),t._v(" 用户，查看虚拟光盘是否已经挂载上来了：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ sudo -i\n# lsblk\nNAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINT\nsda      8:0    0  40G  0 disk\n└─sda1   8:1    0  40G  0 part /\nsr0     11:0    1  57M  0 rom\n")])])]),e("p",[t._v("下面的 "),e("code",[t._v("sr0")]),t._v(" 就是光盘设备，要把它挂载到文件系统中")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("# mount /dev/sr0 /mnt/\nmount: /dev/sr0 is write-protected, mounting read-only\n# cd /mnt/\n# ls\nAUTORUN.INF  cert  OS2           TRANS.TBL                VBoxDarwinAdditionsUninstall.tool  VBoxSolarisAdditions.pkg        VBoxWindowsAdditions.exe\nautorun.sh   NT3x  runasroot.sh  VBoxDarwinAdditions.pkg  VBoxLinuxAdditions.run             VBoxWindowsAdditions-amd64.exe  VBoxWindowsAdditions-x86.exe\n")])])]),e("p",[t._v("在 Linux 系统中要运行 "),e("code",[t._v("VBoxLinuxAdditions.run")]),t._v("，这时候直接运行仍然会报错：")]),t._v(" "),e("p",[t._v("大致意思是要它需要内核的头文件来构建。")]),t._v(" "),e("p",[t._v("头文件通过安装 "),e("code",[t._v("kernel-devel")]),t._v(" 就可以了，但是直接安装的版本是最新版本的，可能会当前的内核版本不一致，仍然是没用的。例如：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@localhost mnt]# uname -r\n3.10.0-1062.12.1.el7.x86_64\n[root@localhost mnt]# yum info kernel-devel\nInstalled Packages\nName        : kernel-devel\nArch        : x86_64\nVersion     : 3.10.0\nRelease     : 1127.el7\nSize        : 38 M\nRepo        : installed\nFrom repo   : base\n")])])]),e("p",[t._v("这里 "),e("code",[t._v("kernel-devel")]),t._v(" 的 "),e("code",[t._v("Release")]),t._v(" 版本号和系统内核版本不一致，所以仍然不行。")]),t._v(" "),e("p",[t._v("需要先更新一把，然后再安装（也可以先安装再更新）：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("# yum update -y\n# yum install -y gcc kernel-devel\n")])])]),e("blockquote",[e("p",[t._v("这里选择的是更新到最新版本，如果你的开发环境需要特定的内核版本，你也可以根据情况安装指定的版本，只要"),e("strong",[t._v("保证内核版本和头文件版本完全匹配")]),t._v("。")]),t._v(" "),e("p",[t._v("Ubuntu 系统的安装方式有所不同，可以参考 "),e("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//www.vagrantup.com/docs/virtualbox/boxes.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vagrant 的文档"),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("升级内核后"),e("strong",[t._v("需要重启虚机")]),t._v("，然后再次尝试重新挂载安装 Additions：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@localhost mnt]# ./VBoxLinuxAdditions.run\nVerifying archive integrity... All good.\nUncompressing VirtualBox 6.1.6 Guest Additions for Linux........\nVirtualBox Guest Additions installer\nRemoving installed version 6.1.6 of VirtualBox Guest Additions...\nCopying additional installer modules ...\nInstalling additional modules ...\nVirtualBox Guest Additions: Starting.\nVirtualBox Guest Additions: Building the VirtualBox Guest Additions kernel\nmodules.  This may take a while.\nVirtualBox Guest Additions: To build modules for other installed kernels, run\nVirtualBox Guest Additions:   /sbin/rcvboxadd quicksetup &lt;version>\nVirtualBox Guest Additions: or\nVirtualBox Guest Additions:   /sbin/rcvboxadd quicksetup all\nVirtualBox Guest Additions: Building the modules for kernel\n3.10.0-1127.el7.x86_64.\nVirtualBox Guest Additions: Running kernel modules will not be replaced until\nthe system is restarted\n\n# 检查模块是否已经加载了\n[root@localhost mnt]# lsmod |grep vbox\nvboxvideo              35867  1\nttm                    96673  1 vboxvideo\ndrm_kms_helper        186531  1 vboxvideo\ndrm                   456166  4 ttm,drm_kms_helper,vboxvideo\nvboxguest             349038  1\n[root@localhost mnt]#\n")])])]),e("p",[t._v("能够看到 "),e("code",[t._v("vboxguest")]),t._v(" 就代表安装成功了。")]),t._v(" "),e("h3",{attrs:{id:"测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[t._v("#")]),t._v(" 测试")]),t._v(" "),e("p",[t._v("在 Vagrantfile 中添加同步文件夹设置，这次不再指定同步类型")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('config.vm.synced_folder "../data", "/vagrant_data"\n')])])]),e("p",[t._v("然后执行 "),e("code",[t._v("vagrant reload")])]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ vagrant reload\n...\n==> default: Checking for guest additions in VM...\n==> default: Rsyncing folder: /cygdrive/c/Users/Davy/demo/ => /vagrant\n==> default: Mounting shared folders...\n    default: /vagrant_data => C:/Users/Davy/data\n==> default: Machine already provisioned. Run `vagrant provision` or use the `--provision`\n==> default: flag to force provisioning. Provisioners marked to run always will still run.\n")])])]),e("p",[t._v("可以看到关于 additions 的提示信息没有了，新的同步文件夹也能正常同步了，这次的同步是双向的。我们可以先去同步文件夹随便创建一个文件：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ vagrant ssh\nLast login: Tue May  5 12:16:39 2020 from 10.0.2.2\n[vagrant@localhost ~]$ cd /vagrant_data/\n[vagrant@localhost vagrant_data]$ ls\ndata.txt\n[vagrant@localhost vagrant_data]$ touch vm.txt   # 新建一个文件\n[vagrant@localhost vagrant_data]$ ls\ndata.txt  vm.txt\n")])])]),e("p",[t._v("回到 Windows 宿主机上，"),e("code",[t._v("data")]),t._v(" 文件夹下面也能看到 "),e("code",[t._v("vm.txt")]),t._v(" 文件，")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("Davy@Davy-Desktop MINGW64 ~/data\n$ ls\ndata.txt  vm.txt\n")])])]),e("p",[t._v("这样，我们的 Guest Addition 就安装成功了。")]),t._v(" "),e("h3",{attrs:{id:"清理磁盘"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#清理磁盘"}},[t._v("#")]),t._v(" 清理磁盘")]),t._v(" "),e("p",[t._v("接下来我们来把这个好不容易才装上了增强包的虚机保存为新的镜像。")]),t._v(" "),e("blockquote",[e("p",[t._v("这里你可能还想安装点其它软件，但是作为基础镜像，最好还是保持干净一点，不宜安装太多东西。后续可以在这个基础之上，再次构建其它特定的镜像。")])]),t._v(" "),e("p",[t._v("为了使做出来的镜像文件大小紧凑点，我们把刚才安装过程中的缓存也删掉：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("yum clean all\n")])])]),e("p",[t._v("我在打包过程中还遇到过 swapfile 占用磁盘空间的问题，导致镜像文件过大，可以这样检查：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("du /swapfile   # 查看是否有占用\nswapoff -a     # 关闭 SWAP\nrm -f /swapfile\n")])])]),e("p",[t._v("使用 "),e("code",[t._v("df -h")]),t._v(" 命令查看磁盘占用情况，像我这次操作，磁盘根目录不到 2GB 的空间占用：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("# df -h\n/dev/sda1        40G  1.5G   39G   4% /\n")])])]),e("h3",{attrs:{id:"打包为-box"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#打包为-box"}},[t._v("#")]),t._v(" 打包为 box")]),t._v(" "),e("p",[t._v("执行 "),e("code",[t._v("vagrant package")]),t._v(" 就可以把当前环境打包生成新的 box 文件：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ vagrant  package\n    ==> default: Attempting graceful shutdown of VM...\n==> default: Clearing any previously set forwarded ports...\n==> default: Exporting VM...\n==> default: Compressing package to: C:/Users/Davy/demo/package.box\n")])])]),e("p",[t._v("生成的文件就在 Dockerfile 所在的目录，文件名默认是 "),e("code",[t._v("package.box")]),t._v("。大小不到 600MB。")]),t._v(" "),e("p",[e("strong",[t._v("注意：")]),t._v("，因为默认启动虚机时本地目录会 rsync 到虚机中，"),e("code",[t._v("package.box")]),t._v(" 文件也会同步（拷贝）到虚机中，占用虚机磁盘。这时候如果二次执行打包，生成的文件大小会翻倍。")]),t._v(" "),e("h3",{attrs:{id:"添加到-vagrant-中"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#添加到-vagrant-中"}},[t._v("#")]),t._v(" 添加到 vagrant 中")]),t._v(" "),e("p",[t._v("继续使用下面的命令把新建的 box 添加到 vagrant 中：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ vagrant box add package.box --name davy/centos-7-base\n")])])]),e("p",[t._v("为了区分这是个人创建的基础镜像，加了个人用户名作为前缀，同时加了 "),e("code",[t._v("base")]),t._v(" 后缀。")]),t._v(" "),e("p",[t._v("添加成功后，本地的 "),e("code",[t._v("package.box")]),t._v(" 就可以删除了。")]),t._v(" "),e("p",[t._v("后续再创建虚机，使用下面的命令就可以了：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ vagrant init davy/centos-7-base\n")])])]),e("h2",{attrs:{id:"使用-ssh-客户端"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用-ssh-客户端"}},[t._v("#")]),t._v(" 使用 SSH 客户端")]),t._v(" "),e("p",[e("code",[t._v("vagrant ssh")]),t._v(" 命令虽然很方便，但是在 Windows 环境下，因为默认的命令行终端不太好用，所以往往还需要使用更专业的 SSH 客户端例如 XShell 或 SecureCRT。")]),t._v(" "),e("p",[t._v("默认的镜像只支持 private_key 的方式登录，"),e("code",[t._v("vagrant/vagrant")]),t._v(" 可以在 VirtualBox 上登录系统，但是如果用来登录 SSH，会被拒绝。")]),t._v(" "),e("p",[t._v("当然你可以在制作镜像的时候修改 ssh 服务的配置，让它能够用密码登录，但是实际上用密钥更加方便。")]),t._v(" "),e("p",[t._v("先使用 "),e("code",[t._v("vagrant ssh-config")]),t._v(" 命令可以看到 SSH 的配置：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ vagrant ssh-config\nHost default\n  HostName 127.0.0.1\n  User vagrant\n  Port 22222\n  UserKnownHostsFile /dev/null\n  StrictHostKeyChecking no\n  PasswordAuthentication no\n  IdentityFile E:/VirtualBox/.vagrant.d/boxes/davy-VAGRANTSLASH-centos-7-base/0/virtualbox/vagrant_private_key\n  IdentitiesOnly yes\n  LogLevel FATAL\n")])])]),e("p",[t._v("可以看到其中的 "),e("code",[t._v("IdentityFile")]),t._v(" 就是私钥文件。")]),t._v(" "),e("p",[t._v("发现这个自定义 box 启动的虚机的密钥文件是固定在 "),e("code",[t._v("VAGRANT_HOME")]),t._v(" 下的相关目录下。那么就好办了，直接在 SSH 客户端软件上导入这个私钥文件就可以了。")]),t._v(" "),e("h2",{attrs:{id:"使用模板文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用模板文件"}},[t._v("#")]),t._v(" 使用模板文件")]),t._v(" "),e("p",[e("code",[t._v("vagrant init")]),t._v(" 命令只是用来生成 Vagrantfile 文件，但是默认的配置选项每次都要修改也很麻烦。该命令提供了 "),e("code",[t._v("--template")]),t._v(" 选项，可以指定一个模板文件，我们可以在自定义自己的模板文件。")]),t._v(" "),e("p",[t._v("这个模板文件的格式 "),e("code",[t._v("ERB")]),t._v(" 是 "),e("code",[t._v("Ruby")]),t._v(" 的模板语法，如果有 "),e("code",[t._v("Ruby on Rails")]),t._v(" 开发经验的可能会比较熟悉。但是我们不用去学习这些细节。")]),t._v(" "),e("p",[t._v("可以从 "),e("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//github.com/hashicorp/vagrant/blob/master/templates/commands/init/Vagrantfile.erb",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),e("OutboundLink")],1),t._v(" 拷贝一份原文件，还能在 Vagrant 的安装位置 "),e("code",[t._v("Vagrant\\embedded\\gems\\2.2.7\\gems\\vagrant-2.2.7\\templates\\commands\\init")]),t._v(" 底下找到，并且有一个 "),e("code",[t._v("Vagrantfile.min.erb")]),t._v(" 是去掉所有注释的：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('Vagrant.configure("2") do |config|\n  config.vm.box = "&lt;%= box_name %>"\n  &lt;% if box_version -%>\n  config.vm.box_version = "&lt;%= box_version %>"\n  &lt;% end -%>\n  &lt;% if box_url -%>\n  config.vm.box_url = "&lt;%= box_url %>"\n  &lt;% end -%>\nend\n')])])]),e("p",[t._v("可以看到其中是怎么配置 "),e("code",[t._v("config.vm.box")]),t._v(" 的。 像 "),e("code",[t._v("<%")]),t._v(" 这样的语法有兴趣可以自己去了解，这里我们只要把自己想要的配置项原样写上去就行了。")]),t._v(" "),e("p",[t._v("下面是我按照自己的需要写的：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('Vagrant.configure("2") do |config|\n  config.vm.box = "&lt;%= box_name %>"\n  config.vm.network "forwarded_port", guest: 22, host: 2222, id: "ssh", disabled: "true"\n  config.vm.network "forwarded_port", guest: 22, host: 22222\n\n  # config.vm.network "private_network", ip: "192.168.56.10"\n  # config.vm.synced_folder "../data", "/data"\n\n  config.vm.provider "virtualbox" do |vb|\n    # vb.name = "give me a better name"\n    vb.memory = "1024"\n  end\nend\n')])])]),e("blockquote",[e("p",[t._v("不要有中文，不然会遇到编码的麻烦。")])]),t._v(" "),e("p",[t._v("其中像私有网络和同步文件夹配置，几乎每次基本都要，但是又不好固定，所以仍然以注释的形式保留，每次稍微改一下也很方便。")]),t._v(" "),e("p",[t._v("把这个文件找个目录，保存为 "),e("code",[t._v("vagrant.erb")]),t._v("。")]),t._v(" "),e("p",[t._v("接着在使用 "),e("code",[t._v("vagrant init")]),t._v(" 的时候通过 "),e("code",[t._v("--tempate")]),t._v(" 指定它就可以了，例如：")]),t._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('vagrant init davy/centos-7-base --tempate "C:\\Users\\Davy\\vagrant.erb"\n')])])]),e("p",[t._v("显然，每次要记住并且输入这个模板文件也很麻烦的。可以通过设置环境变量 "),e("code",[t._v("VAGRANT_DEFAULT_TEMPLATE")]),t._v(" 来一劳永逸地解决这个问题。")])])}),[],!1,null,null,null);a.default=s.exports}}]);